<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta charset="iso-8559-1"/>
	<meta name="description" content="Time of War is a fast-paced third-person shooter."/>
	<meta name="keywords" content="wars, online game, shooter, rpg"/>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Time of war</title>
    <link rel="stylesheet" type="text/css" href="css/css_principal_page.css"/>
</head>
<body> 
    <div class="loader">
        Connecting...
    </div>
    <div id="part1">
    	<aside class="leftaside">
        	<div class="h1container">   
                <h1>TimeOfWar.io</h1>
                <div class="bullet">
                    <img src="css/keys/images/bullet.png" width="15" height="25"7>
                </div>
            </div>
        	<div class="leftasideweapon">
                <header>
                    <div class="headerleftasidecontainer">
                        <span>WEAPON TYPE</span>
                    </div>
                </header>
                <div class="weaponconfig">
                    <aside class="leftarrow">
                        <button class="leftarrowbutton" onClick="var b = play(); left_weapon(); return b"></button>
                    </aside>
                    <div class="weaponcontainer" style="margin-left:50px;">
                        <section class="weapon">
                        </section>
                    </div>
                    <aside class="rightarrow">
                        <button class="rightarrowbutton" onClick="var b = play(); right_weapon(); return b"></button>
                    </aside>
                    <footer class="weaponname">
                    </footer>
                </div>
                <div class="stats">
    	            INITIAL STATS
                </div>
                <div class="weaponstats">
                	<div>
                    	<span class="range">RANGE</span><br>
                        <div>
                            <canvas class="rangebarcanvas" width="430" height="10" style="margin-left:5px;"></canvas>
                        </div>
                	</div>
                    <div>
    	                <span class="rpm">RPM</span><br>
                        <div>
                            <canvas class="rpmbarcanvas" width="430" height="10" style="margin-left:5px;"></canvas>                        
                        </div>
                    </div>
                    <div>
    	                <span class="damage">DAMAGE</span><br>
                        <div>
                            <canvas class="damagebarcanvas" width="430" height="10" style="margin-left:5px;"></canvas>                        
                        </div>                    
                    </div>
                    <div>
    	                <span class="charger">CHARGER SIZE</span>                                                                                      
                        <div>
                            <canvas class="chargerbarcanvas" width="430" height="10" style="margin-left:5px;"></canvas>                        
                        </div>                    
                    </div>
                </div>
            </div>
        </aside>
        <div class="center">     
            <header class="centerheader">
                <div class="logo">              
                    <img src="css/keys/images/logo.png" width="400" height="240"/>
                </div>
                <div class="start">	
                    <section class="playername">
                        <label>PLAYER NAME</label>
                        <input maxlength="20" class="inputname" type="text" name="nameplayer"/>
                    </section> 
                    <section>
                        <button class="startbutton" onClick="var b = play(); start(); return b">START GAME</button>
                    </section> 
                    <section class="imagecenter">
                        <img src="css/keys/images/player.png" width="200" height="130"/>
                    </section> 
                    <section>
                        <button class="tutorialbutton" onClick="var b = play(); 
                        tutorial('id1');
                        tutorial('id2');
                        tutorial('id3');                    
                        return b">TUTORIAL</button>
                        <!-- Appear and disappear -->
                        <div id="id1" class="tutorial" style=" 
                        	text-align:center; 
                            font-weight:bold; 
                            font-size:36px; 
                            font:Arial, Helvetica, sans-serif;
                            background-color:#999;">
                        </div>
                        <div id="id2" class="tutorial" style="
                        	text-align:left; 
                            font-weight:bold;
                            top:140px;
                            font:Arial, Helvetica, sans-serif;
                            background-color:#CCC;
                            overflow-y: scroll;">
                        </div>
                        <div id="id3" class="tutorial" style="
                        	text-align:center;
                            height:25px;                        
                            top:475px;
                            width:591px;
                            margin-left:0px;
                            border-top-color:#CCC;
                            border-right-color:#CCC;">
                        </div>                                               
                    </section>                                  
                </div>
            </header>
        </div>
    	<aside class="rightaside">
            <div class="socialmediacontainer">
            	<div class="socialmedia">
                	Follow us in social media!
                </div>
                <div class="fbcontainer">
    	            <button class="fb" onclick=" window.open('https://www.facebook.com/rodrigo.teran.127','_blank')"></button>
                </div>
            </div>
            <div class="player">
                <header class="headerleftasidecontainer"> 
                    CUSTOMIZE YOUR PLAYER
                </header>
                <div class="playercontainer">
                    <div class="weaponconfig"> 
                        <div class="weaponcontainer" style="margin-left:60px;"> 
                            <section class="weapon"> 
                            </section>
                        </div>
                        <section>
                            <button class="greentank" onClick="var b = play(); change_color(0); return b">
                            </button>
                            
                            <button class="redtank" onClick="var b = play(); change_color(1); return b">
                            </button>
                            
                            <button class="bluetank" onClick="var b = play(); change_color(2); return b">
                            </button>                                                
                        </section>
                        <footer class="weaponname" style="margin-top:7px;">
    	                    TANK COLOR
                        </footer>
                    </div>
                </div>
            </div>
            <div class="ad">
            	<p class="realad">SPACE FOR ADS</p>
            </div>        
        </aside> 
        <footer class="finalfooter">
        	footer de hasta abajo<br>
        	footer de hasta abajo<br>
        	footer de hasta abajo<br>
        	footer de hasta abajo<br>
        	footer de hasta abajo                                           
        </footer>
    </div>
    <div id="part2">
        <!--<button onclick="finish();">putos</button>-->
        <canvas class="canvasgame" width="1500" height="696" style=" 
        background-color:rgba(160, 160, 160, 1);
        border: 2px solid #000">
        </canvas>
        <div id="namegame">
        </div>
        <div id="tankgame">
        </div>              
    </div>
    <script type="text/javascript" src="https://cdn.socket.io/socket.io-1.4.5.js"> // Sockets
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"> // JQuery libary
    </script> 

    <script type="text/javascript"> // loading page
    $(window).load(function() {
        $(".loader").fadeOut("slow");
        document.getElementById("part1").style.display = 'block';
    });
    </script>
    
    <script type="text/javascript">
        // --------------------------------------------------------------------VARIABLES
        var names_of_weapon_list = ["SINGLE SHOT", "MACHINE GUN", "BOMB"];
        var superlist = [
            ['<img src="css/keys/tanks/side_tanks/red/st0.png" width="160" height="100"/>',  // red
            '<img src="css/keys/tanks/side_tanks/red/st1.png" width="160" height="100"/>',
            '<img src="css/keys/tanks/side_tanks/red/st2.png" width="160" height="100"/>'],
            
            ['<img src="css/keys/tanks/side_tanks/green/st0.png" width="160" height="100"/>',  // green
            '<img src="css/keys/tanks/side_tanks/green/st1.png" width="160" height="100"/>',
            '<img src="css/keys/tanks/side_tanks/green/st2.png" width="160" height="100"/>'],
            
            ['<img src="css/keys/tanks/side_tanks/blue/st0.png" width="160" height="100"/>',  // blue
            '<img src="css/keys/tanks/side_tanks/blue/st1.png" width="160" height="100"/>',
            '<img src="css/keys/tanks/side_tanks/blue/st2.png" width="160" height="100"/>'],
        ];
        var superlist_2 = [
            ["css/keys/tanks/red/r_b.png",  // red
            "css/keys/tanks/red/r_b.png",
            "css/keys/tanks/red/r_b.png"],
            
            ["css/keys/tanks/green/g_b.png",  // green
            "css/keys/tanks/green/g_b.png",
            "css/keys/tanks/green/g_b.png"],
            
            ["css/keys/tanks/blue/b_b.png",  // blue
            "css/keys/tanks/blue/b_b.png",
            "css/keys/tanks/blue/b_b.png"],
        ];  
        var superlist_3 = [
            ["css/keys/tanks/red/r_1.png",  // red
            "css/keys/tanks/red/r_2.png",
            "css/keys/tanks/red/r_0.png"],
            
            ["css/keys/tanks/green/g_1.png",  // green
            "css/keys/tanks/green/g_2.png",
            "css/keys/tanks/green/g_0.png"],
            
            ["css/keys/tanks/blue/b_1.png",  // blue
            "css/keys/tanks/blue/b_2.png",
            "css/keys/tanks/blue/b_0.png"],
        ];
        var superlistposition = 0;  // COLOR
        var insidelistposition = 0;  // WEAPON

        // CANVAS
        var ctx_range = document.getElementsByClassName("rangebarcanvas")[0].getContext("2d");
        var ctx_rpm = document.getElementsByClassName("rpmbarcanvas")[0].getContext("2d");
        var ctx_damage = document.getElementsByClassName("damagebarcanvas")[0].getContext("2d");
        var ctx_charger_size = document.getElementsByClassName("chargerbarcanvas")[0].getContext("2d"); 
        var width_range = 0;
        var width_rpm = 0;
        var width_damage = 0;
        var width_charger = 0;
        var howmuch_range = 0;
        var howmuch_rpm = 0;
        var howmuch_damage = 0;
        var howmuch_charger = 0;
        // CANVAS

        // Check speed navigator
        var is_chrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;
        var is_firefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;
        var is_opera = navigator.userAgent.toLowerCase().indexOf('opera');              
        // Check speed navigator

        // Variable play audio
        var audio = new Audio("css/keys/sounds/sound_1.mp3");
                
        // --------------------------------------------------------------------FUNCTIONS 1
        function play(){
            audio.play();
        };      
        function change_weapon(){
            write_();   //write and draw weapon
            change_stats();     //canvas
            clear();    //clear the stats before this ones, then call draw()
        };
        function right_weapon(){            // Call outside change weapon
            if(insidelistposition == 2){
                insidelistposition = 0;
            }
            else{
                insidelistposition += 1;
            };
            change_weapon();
        };
        function left_weapon(){         // Call outside change weapon
            if(insidelistposition == 0){
                insidelistposition = 2;
            }
            else{
                insidelistposition -= 1;
            };
            change_weapon();
        };          
        function change_color(color){           // Call outside change color
            // green, red, blue
            if(color == 0){
                superlistposition = 1;
            };
            if(color == 1){
                superlistposition = 0;              
            };
            if(color == 2){
                superlistposition = 2;              
            };
            write_();               
        };      
        function write_(){
            document.getElementsByClassName("weaponname")[0].innerHTML=names_of_weapon_list[insidelistposition];    //write weapon name
            document.getElementsByClassName("weapon")[0].innerHTML=know_tank(); //draw tank (weapon side)
            document.getElementsByClassName("weapon")[1].innerHTML=know_tank(); // draw tank (color side)
        };
        function know_tank(){   //know what tank to draw
            var color_position = superlist[superlistposition];
            var actual_tank = color_position[insidelistposition];
            return actual_tank;
        };
        function know_tank_2(){   //know what tank to draw
            var color_position = superlist_2[superlistposition];
            var actual_tank = color_position[insidelistposition];
            return actual_tank;
        };
        function know_tank_3(){   //know what tank's weapon to draw
            var color_position = superlist_3[superlistposition];
            var actual_tank = color_position[insidelistposition];
            return actual_tank;
        }; 
        function change_stats(){
            if(insidelistposition == 0){    //"SINGLE SHOT"
                howmuch_range = 350;
                howmuch_rpm = 210;
                howmuch_damage = 120;
                howmuch_charger = 150;
            };
            if(insidelistposition == 1){    //"MACHINE GUN"
                howmuch_range = 100;
                howmuch_rpm = 400;
                howmuch_damage = 70;
                howmuch_charger = 200;
            };
            if(insidelistposition == 2){    //"BOMB"
                howmuch_range = 250;
                howmuch_rpm = 50;
                howmuch_damage = 400;
                howmuch_charger = 50;
            };              
        };
        function draw(){
            ctx_range.fillStyle = "#00274F";
            ctx_range.fillRect(0, 0, width_range, 10);
            ctx_rpm.fillStyle = "#00274F";
            ctx_rpm.fillRect(0, 0, width_rpm, 10);
            ctx_damage.fillStyle = "#00274F";
            ctx_damage.fillRect(0, 0, width_damage, 10);
            ctx_charger_size.fillStyle = "#00274F";
            ctx_charger_size.fillRect(0, 0, width_charger, 10);
            if(width_range <= howmuch_range){
                width_range += 10;
            };
            if(width_charger <= howmuch_charger){
                width_charger += 10;
            };
            if(width_rpm <= howmuch_rpm){
                width_rpm += 10;
            };
            if(width_damage <= howmuch_damage){
                width_damage += 10;
            };
        };
        function check_navigator(){
            if(is_firefox){
                speed = 15;
                return speed;
            };
            if(is_opera){
                speed = 15;
                return speed;
            };
            if(is_chrome){
                speed = 15;
                return speed;
            };
            if (document.documentMode || /Edge/.test(navigator.userAgent)) {
                speed = .1;
                return speed;
            };
        };
        function clear(){
            width_range = 0;
            width_rpm = 0;
            width_damage = 0;
            width_charger = 0;
            ctx_range.clearRect(0, 0, 420, 10);
            ctx_rpm.clearRect(0, 0, 420, 10);
            ctx_damage.clearRect(0, 0, 420, 10);
            ctx_charger_size.clearRect(0, 0, 420, 10);
            draw();
        };
        function tutorialbutton(){
            var b = play(); tutorial("id1"); tutorial("id2"); tutorial("id3"); 
            return b;
        };
        function tutorial(id){  //hide and show the tutorial section
            var margin_top_final_footer = document.getElementsByClassName("finalfooter")[0];
            if(margin_top_final_footer.style.marginTop == '115px'){
                margin_top_final_footer.style.marginTop = '123px'; // plus 8px
            }else{
                margin_top_final_footer.style.marginTop = '115px';
            };          
            var new_block = document.getElementById(id);
            if(new_block.className == 'tutorial'){
                new_block.className = '';
                document.getElementById(id).innerHTML="";
            }else{
                new_block.className = 'tutorial';
                if(id == "id1"){
                    document.getElementById(id).innerHTML='TUTORIAL';
                };      
                if(id == "id2"){
                    document.getElementById(id).innerHTML=
                    '1. The game consist of 2 teams that fight against each other<br>'+
                    '2. Each team have a king tank, when the king tank is destroyed you loose, or when the enemy king tank enter in your base<br>'+
                    '3. You can build blocks and attack with your weapon<br>'+
                    '4. The weapon damage, life, speed, and health regeneration<br>'+
                    'speed can be upgraded by collecting coins and then upgraded those things in the shop<br>'+
                    '6. The coins will be spread out in the map<br>'+
                    '7. When you die you respawn immediately but with all upgrades in zero, and with the previous amount of collected coins by 1/4<br>'+
                    'In the first minute of the game:<br>'+
                    '1. In the first minute of the game, the two teams can build<br>'+
                    '2. The teams cannot shoot <br>'+
                    '3. The teams cannot pass the center line<br>'+
                    '4. You can collect coins and upgrade<br>'+
                    'During the rest of the game:<br>'+
                    '1. The teams now can shoot, and build<br>'+
                    '2. You can collect coins and upgrade<br>'+
                    '2. You can collect coins and upgrade<br>'+
                    '2. You can collect coins and upgrade<br>'+
                    '2. You can collect coins and upgrade<br>'+
                    '2. You can collect coins and upgrade<br>'+
                    '2. You can collect coins and upgrade<br>'+
                    '2. You can collect coins and upgrade<br>'+
                    '3. The goal is to destroy and not let the enemy king tank enter your base<br>'+
                    '<br>'+
                    '<br>';
                };
                if(id == "id3"){
                    document.getElementById(id).innerHTML='<button class="startbutton" onClick="tutorialbutton();">Got it bro!';
                };
            };
        };
        // --------------------------------------------------------------------FUNCTIONS 2
        var ctxgame = document.getElementsByClassName("canvasgame")[0].getContext("2d");
        var socket = io();

        function start2(){
            document.getElementById("part2").style.display = 'block';
        };
        function start(){  //hide the main page and show game
            document.getElementById("part1").style.display = 'none';
            start2();
            knowgame();
        };    
        function finish2(){
            document.getElementById("part2").style.display = 'none';
        };
        function finish(){  //hide the game and show main page
            document.getElementById("part1").style.display = 'block';
            finish2();
        };
        function getname_(){
            var nameplayer = document.getElementsByName("nameplayer")[0].value;
            return nameplayer;
        };
        function knowgame(){    // it is called when the client pushes the start button
            var tank_ = know_tank_2();
            var tank_w = know_tank_3();            
            var tank_name = getname_();
            socket.emit("tankOfClient", {
                tankId:tank_, 
                name:tank_name,
                weatank:tank_w,
            });
        };
        // --------------------------------------------------------------------CALL INITIAL FUNCTIONS
        tutorial('id1');
        tutorial('id2');
        tutorial('id3'); 
        write_();
        setInterval(draw, check_navigator());
        change_stats();
        draw();
        // --------------------------------------------------------------------ONLINE GAME LOGIC
        var imgmap = new Image();
        imgmap.src = "/client/css/keys/images/map.png";
        // --------------------------------------------------------------------FUNCTIONS
        function drawImageR(context, image, x, y, angle, width_i, height_i){
            context.save();
            context.translate(x + (width_i / 2), y + (height_i / 2));
            context.rotate((angle*Math.PI)/180);
            context.drawImage(image, (-width_i / 2), (-height_i / 2), width_i, height_i);
            context.restore();
        };     
        socket.on("new_position", function(data){
            ctxgame.clearRect(0, 0, 1500, 696);
            for(var i = 0; i < data.player.length; i++){
                function drawPlayers(){
                    var img = new Image();
                    var img2 = new Image();
                    img.src = data.player[i].tank;
                    img2.src = data.player[i].tankw;
                    // The tank
                    drawImageR(ctxgame, img, data.player[i].x, data.player[i].y, data.player[i].angle, 80, 80);  // chasis
                    drawImageR(ctxgame, img2, data.player[i].x + 20, data.player[i].y - 25, data.player[i].angle, 40, 120);   // weapon
                    // The tank's name
                    ctxgame.lineWidth = .5;
                    ctxgame.strokeStyle = 'white';
                    ctxgame.font = "20px Verdana";
                    ctxgame.strokeText(data.player[i].name, data.player[i].x + data.player[i].detOfName, data.player[i].y - 30);    // name
                };
                drawPlayers();
            };
        });
        document.onkeydown = function(event){
            if(event.keyCode === 68)    //d
                socket.emit("keyPress", {inputId:"right", state:true});
            else if(event.keyCode === 83)   //s
                socket.emit("keyPress", {inputId:"down", state:true});
            else if(event.keyCode === 65)   //a
                socket.emit("keyPress", {inputId:"left", state:true});
            else if(event.keyCode === 87)   //w
                socket.emit("keyPress", {inputId:"up", state:true});                        
        };
        document.onkeyup = function(event){
            if(event.keyCode === 68)    //d
                socket.emit("keyPress", {inputId:"right", state:false});
            else if(event.keyCode === 83)   //s
                socket.emit("keyPress", {inputId:"down", state:false});
            else if(event.keyCode === 65)   //a
                socket.emit("keyPress", {inputId:"left", state:false});
            else if(event.keyCode === 87)   //w
                socket.emit("keyPress", {inputId:"up", state:false});                       
        };
        document.onmousemove = function(event){
            var mx = event.clientX;
            var my = event.clientY;
            socket.emit("mousePos", {mouseX:mx, mouseY:my});
        };
    </script>
</body>
</html>
 